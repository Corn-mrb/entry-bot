# Discord QR 입장 봇 - 요구사항 정리

## 흐름
```
/매장등록 (기존 채널 지정: #┆✅ㅣ하우스ㅣ센터∶입장이력)
    ↓
QR 코드 생성 (discord.gg/xxx 초대 링크)
    ↓
QR 스캔 → Discord 앱 열림 → 해당 채널로 이동
    ↓
채널에 있는 ✅ 체크인 버튼 클릭
    ↓
[암구호 설정시] Modal 팝업 → 입력
    ↓
[역할 검증] 최소 역할 확인
    ↓
✅ 성공 / ❌ 실패 → 매장주 DM 알림
```

## 핵심 기능

| 기능 | 설명 |
|------|------|
| **기존 채널 사용** | 새 채널 생성 X, 지정한 채널 사용 |
| **초대 링크 자동 갱신** | 15분마다 새 링크 생성 (보안) |
| **체크인 버튼** | 채널에 버튼 1개, 클릭하면 체크인 |
| **암구호 (선택)** | 설정시 Modal로 입력 |
| **역할 검증 (선택)** | 최소 역할 이상만 체크인 가능 |
| **DM 알림** | 성공/실패 모두 매장주에게 DM |
| **하루 1회 제한** | 같은 날 중복 체크인 방지 |

## 보안
- QR 유출 대비 → 15분마다 초대 링크 갱신
- 기존 링크는 자동 만료

## 우선순위
1. **1순위**: 초대 링크 자동 갱신 (15분) + 체크인 시스템
2. **2순위**: 웹 대시보드 + QR 표시 + 데이터 내보내기

---

## 2순위: 웹 대시보드

### 구현 구조
```
visits.json (DB)
    ↓
FastAPI 웹서버 (API)
    ↓
웹페이지 (Chart.js)
    ↓
그래프 표시 + 내보내기
```

### 대시보드 기능
| 기능 | 설명 |
|------|------|
| **실시간 QR 표시** | 태블릿에서 자동 갱신되는 QR |
| **방문 내역 리스트** | 일자별/매장별 방문 기록 |
| **막대 그래프** | 일별/월별 방문자 통계 |
| **파이 차트** | 방문자 비율 |
| **라인 차트** | 방문 추이 |
| **날짜 필터링** | 기간별 조회 |

### 데이터 내보내기
| 형식 | 설명 |
|------|------|
| `.xlsx` | Excel 표 형태 |
| `.csv` | CSV 데이터 |
| `.pdf` | 그래프 포함 보고서 |

### QR 발급 이력 저장
- `/QR재발급` 시 DB에 이력 저장
  - 발급 시간
  - 초대 링크
  - 만료 시간
  - 발급자

## 도메인
- **필요 없음** - Discord 봇만으로 운영
- (나중에 웹페이지 추가시에만 필요)

## 슬래시 명령어

| 명령어 | 설명 |
|--------|------|
| `/매장등록` | 매장 생성 + 체크인 버튼 + QR 발급 |
| `/매장수정` | 매장 정보 수정 (암구호, 역할 등) |
| `/매장삭제` | 매장 삭제 |
| `/매장목록` | 내 매장 목록 보기 |
| `/QR재발급` | QR 코드 재발급 |
| `/매장방문` | 방문자 목록 |
| `/매장통계` | 방문 통계 (막대 그래프) |
| `/매장방문기록` | 특정 유저 방문 기록 |
| `/매장기록` | 전체 방문 기록 xlsx 다운로드 |
| `/매장체크인초기화` | 특정 유저 오늘 체크인 초기화 |
| `/매장방문삭제` | 특정 유저 전체 방문 기록 삭제 |

## 체크인 채널
- `#┆✅ㅣ하우스ㅣ센터∶입장이력`

## 파일 구조
```
entry-bot/
├── bot.py          # 메인 봇 코드
├── config.py       # 설정 (토큰, 길드ID 등)
├── database.py     # JSON 데이터 관리
├── .env            # 환경변수
├── web.py          # 웹서버 (2순위)
├── templates/      # 웹페이지 템플릿 (2순위)
│   ├── dashboard.html
│   └── qr.html
└── data/
    ├── stores.json # 매장 데이터
    ├── visits.json # 방문 기록
    └── qr_logs.json # QR 발급 이력
```
